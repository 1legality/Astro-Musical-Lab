---
// src/layouts/MainLayout.astro
import { getCollection, type CollectionEntry } from "astro:content";
import "../styles/global.css";

// Get all rhythms and sort them by the 'order' prop
const allRhythms = (await getCollection("rhythms")).sort(
  (a: CollectionEntry<"rhythms">, b: CollectionEntry<"rhythms">) =>
    a.data.order - b.data.order,
);

const chordTools = (await getCollection("ChordProgressionTool")).sort(
  (
    a: CollectionEntry<"ChordProgressionTool">,
    b: CollectionEntry<"ChordProgressionTool">,
  ) => a.data.order - b.data.order,
);

const { title } = Astro.props;
---

<html lang="en" data-theme="cyberpunk">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{title} | Rhythm Guide</title>
    <link rel="icon" href="/favicon.svg" />
  </head>
  <body class="min-h-screen bg-base-200 text-base-content antialiased">
    <div class="drawer">
      <input id="nav-drawer" type="checkbox" class="drawer-toggle" />
      <div class="drawer-content flex flex-col">
        <nav class="navbar bg-base-100 shadow-sm z-50">
          <div class="navbar-start">
            <label
              for="nav-drawer"
              class="btn btn-ghost lg:hidden mr-2"
              aria-label="Open menu"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                class="inline-block w-6 h-6 stroke-current"
                ><path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"></path></svg
              >
            </label>
            <a class="btn btn-ghost normal-case text-xl" href="/"
              >Rhythm Guide</a
            >
          </div>
          <div class="navbar-center hidden lg:flex">
            <ul class="menu menu-horizontal px-1">
              <li><a class="font-semibold" href="/">Home</a></li>
              {
                chordTools.length > 0 ? (
                  <li>
                    <a
                      class="font-semibold"
                      href={`/tools/${chordTools[0].slug}`}
                    >
                      Chord Progression tool
                    </a>
                  </li>
                ) : (
                  <li>
                    <a class="font-semibold" href="/tools">
                      Chord Progression tool
                    </a>
                  </li>
                )
              }
              <li>
                <a class="font-semibold" href="/drum-patterns/basic-patterns"
                  >Drum Patterns</a
                >
              </li>
              <li>
                <a class="font-semibold" href="/rhythms/pulse-generator"
                  >Pulse Generator</a
                >
              </li>
              <li>
                <details>
                  <summary class="font-semibold">Other</summary>
                  <ul
                    class="p-2 bg-base-100 absolute right-0 top-5 mt-4 w-80 shadow-xl rounded-box z-[100]"
                  >
                    {
                      allRhythms
                        .filter((r) => r.slug !== "pulse-generator")
                        .map((r) => (
                          <li>
                            <a href={`/rhythms/${r.slug}`}>{r.data.title}</a>
                          </li>
                        ))
                    }
                  </ul>
                </details>
              </li>
            </ul>
          </div>
          <div class="navbar-end hidden md:flex">
            <!-- reserved for midi selector or controls -->
          </div>
        </nav>

        <main class="mx-auto w-full max-w-7xl px-4 py-8 space-y-6">
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h1 class="card-title text-3xl font-bold">{title}</h1>
              <article class="prose prose-invert max-w-none">
                <slot />
              </article>
            </div>
          </div>
        </main>
      </div>
      <div class="drawer-side lg:hidden">
        <label
          for="nav-drawer"
          aria-label="close sidebar"
          class="drawer-overlay"></label>
        <nav
          class="menu bg-base-100 text-base-content min-h-screen w-screen p-6 space-y-6 overflow-y-auto"
        >
          <div>
            <h2
              class="menu-title text-sm uppercase tracking-widest text-base-400"
            >
              Menu
            </h2>
            <ul class="space-y-1">
              <li>
                <a class="font-semibold" href="/">Home</a>
              </li>
              {
                chordTools.length > 0 ? (
                  <li>
                    <a
                      class="font-semibold"
                      href={`/tools/${chordTools[0].slug}`}
                    >
                      Chord Progression tool
                    </a>
                  </li>
                ) : (
                  <li>
                    <a class="font-semibold" href="/tools">
                      Chord Progression tool
                    </a>
                  </li>
                )
              }
              <li>
                <a class="font-semibold" href="/drum-patterns/basic-patterns"
                  >Drum Patterns</a
                >
              </li>
              <li>
                <a class="font-semibold" href="/rhythms/pulse-generator"
                  >Pulse Generator</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h2
              class="menu-title text-sm uppercase tracking-widest text-base-400"
            >
              Other
            </h2>
            <ul class="space-y-1">
              {
                allRhythms
                  .filter((rhythm) => rhythm.slug !== "pulse-generator")
                  .map((rhythm) => (
                    <li>
                      <a class="font-semibold" href={`/rhythms/${rhythm.slug}`}>
                        {rhythm.data.title}
                      </a>
                    </li>
                  ))
              }
            </ul>
          </div>
        </nav>
      </div>
    </div>
  </body>
</html>
